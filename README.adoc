image:https://github.com/tillkuhn/billy-idle/actions/workflows/go.yml/badge.svg[ci-build]

== ğŸ’¤ Billy Idle - Lightweight macOS (In)activity Tracker

Simple busy / idle time tracker inspired by the ancient article https://www.dssw.co.uk/blog/2015-01-21-inactivity-and-idle-time/[Inactivity and Idle Time on OS X].


== Background

According to the article, OS X has a timer called *HIDIdleTime* that tracks the last time you interacted with the computer, e.g. moved the mouse, typed a key, or interacted with the computer.

*billy-idle* simply queries this value periodically using the `ioreg` utility that ships with macOS, and matches it against a pre-defined threshold. If exceeded, it will create a record for the busy time period in database. This data can later be used as input for time tracking tools or statistics.

== Run form source

[source,shell]
----
$ go run main.go

2024/09/28 00:43:52 [BigMac] ğŸ¬ billy-idle tracker started version=latest commit=e95d72f
2024/09/28 00:44:09 [BigMac] ğŸ’¤ Entering idle mode after 17s of busy time, completing record #1
2024/09/28 00:44:13 [BigMac] ğŸ Resuming busy mode after 4s of idle time, creating new record #2
2024/09/28 00:44:27 [BigMac] ğŸ’¤ Entering idle mode after 14s of busy time, completing record #2
2024/09/28 00:45:25 [BigMac] ğŸ Resuming busy mode after 58s of idle time, creating new record #3
2024/09/28 00:45:37 [BigMac] ğŸ’¤ Entering idle mode after 12s of busy time, completing record #3
2024/09/28 00:45:45 [BigMac] ğŸ Resuming busy mode after 8s of idle time, creating new record #4
2024/09/28 00:45:48 [BigMac] ğŸ›‘ Received Signal interrupt
2024/09/28 00:45:49 [BigMac] ğŸ›‘ tracker stopped
----

NOTE: Binary packages for macOS amd64 and arm64 are coming soon, the same goes for docker images on ghcr.io

== Install as launchd managed service (experimental)

Plist files in ~/Library/LaunchAgents/ are run at login with the id of the logged in user.
See https://stackoverflow.com/a/13372744/4292075[SO: launchctl and .plist file],
https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/[Create and manage MacOS LaunchAgents using Go]
and  https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html#//apple_ref/doc/uid/10000172i-SW7-BCIEDDBJ[Launching Custom Daemons Using launchd]

[source,shell]
----
$ cp com.github.tillkuhn.billy-idle.plist ~/Library/LaunchAgents
$ launchctl load ~/Library/LaunchAgents/com.github.tillkuhn.billy-idle.plist
$ launchctl start com.github.tillkuhn.billy-idle

# in case of Load failed: 5: Input/output error, try this first
$ launchctl unload ~/Library/LaunchAgents/com.github.tillkuhn.billy-idle.plist
----

== CLI Arguments

[source,shell]
----
$ billy-idle help
  -cmd string
    	Command to retrieve HIDIdleTime (default "ioreg")
  -idle duration
    	Max time before client is considered idle (default 10s)
  -interval duration
    	Interval to check for idle time (default 2s)
----

== Database Support

*Billy Idle* currently only support a local https://gitlab.com/cznic/sqlite[sqlite] database, more precisely `modernc.org/sqlite` which is a cgo-free port of SQLite. But it shouldn't be a big deal to add support for a remote https://www.postgresql.org[PostgreSQL] Database.

image:docs/sqlite.png[]

== Development

[source,shell]
----
$ make
Usage: make <OPTIONS> ... <TARGETS>

Available targets are:

build                build all targets
clean                Clean output directory
help                 Shows the help
lint                 Lint go code
minor                Create Minor Release
run                  Run tracker
test                 Test go code
update               Update all go dependencies
----

== ğŸ¸ Credits

image:https://upload.wikimedia.org/wikipedia/commons/thumb/7/74/Billy_idol_ill_artlibre_jnl.png/640px-Billy_idol_ill_artlibre_jnl.png[]

Source: https://commons.wikimedia.org/wiki/File:Billy_idol_ill_artlibre_jnl.png[Wikimedia Commons], terms of the https://en.wikipedia.org/wiki/en:Free_Art_License[Free Art License] apply.

== Contribution

If you want to contribute to *rubin* please have a look at the xref:CONTRIBUTING.md[]
